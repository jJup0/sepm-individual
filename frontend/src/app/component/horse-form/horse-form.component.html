<p *ngIf="!horse">loading horse...</p>
<form #horseForm="ngForm" *ngIf="horse">
  <label for="name">Name</label>
  <input
    type="text"
    class="form-control"
    id="name"
    required
    [(ngModel)]="horse.name"
    name="name"
    #name="ngModel"
  />
  <div [hidden]="name.valid || name.pristine" class="alert alert-danger">
    Name is required
  </div>

  <div class="form-group">
    <label for="description">Description</label>
    <input
      type="text"
      class="form-control"
      id="description"
      [(ngModel)]="horse.description"
      name="description"
    />
  </div>

  <div class="form-group">
    <label for="birthdate">Birthdate</label>
    <input
      #birthdateIdentifier
      type="date"
      class="form-control"
      id="birthdate"
      name="birthdate"
      [value]="horseBirthdayISO()"
      [max]="todaysDateISO()"
      required
      (input)="setBirthdate(birthdateIdentifier.value)"
    />
  </div>

  <div class="form-group">
    <div *ngFor="let sex of SEXES">
      <input
        id="sex"
        type="radio"
        name="sexesradio"
        [value]="sex"
        [(ngModel)]="horse.sex"
      />
      <label for="sex">{{ sex | titlecase }}</label>
    </div>
  </div>

  <div class="form-group">
    <label for="description">Owner</label>
    <input
      type="text"
      class="form-control"
      id="description"
      [(ngModel)]="horse.owner"
      name="description"
    />
  </div>

  <div class="form-group">
    <label for="mother-input-search-box">Mother</label>
    <input
      #motherSearchBox
      type="text"
      class="form-control"
      name="mother-input"
      id="mother-input-search-box"
      [value]="horse.mother.name"
      (input)="
        search(
          {
            searchTerm: motherSearchBox.value,
            sex: 'female',
            bornBefore: horse.birthdate
          },
          'mother'
        )
      "
    />
    <select
      #motherSelect
      id="mothers"
      name="mother-select"
      (input)="setParent(motherSelect.value, 'mother')"
    >
      <option value="" disabled selected>Select mother</option>
      <option *ngIf="horse.mother" [value]="horse.mother | json" selected>
        {{ horse.mother.name }}
      </option>

      <option
        *ngFor="let mother of loadedMothers$ | async"
        [value]="mother | json"
      >
        {{ mother.name }}
      </option>
    </select>
  </div>

  <!--  -->
  <div class="form-group">
    <label for="father-input-search-box">Father</label>
    <input
      #fatherSearchBox
      type="text"
      class="form-control"
      name="father-input"
      id="father-input-search-box"
      [value]="horse.father.name"
      (input)="
        search(
          {
            searchTerm: fatherSearchBox.value,
            sex: 'male',
            bornBefore: horse.birthdate
          },
          'father'
        )
      "
    />
    <select
      #fatherSelect
      id="fathers"
      name="father-select"
      (input)="setParent(fatherSelect.value, 'father')"
    >
      <option value="" disabled selected>Select father</option>
      <option *ngIf="horse.father" [value]="horse.father | json" selected>
        {{ horse.father.name }}
      </option>

      <option
        *ngFor="let father of loadedFathers$ | async"
        [value]="father | json"
      >
        {{ father.name }}
      </option>
    </select>
  </div>

  <!--  -->
  <button
    type="submit"
    class="btn btn-success"
    [disabled]="!horseForm.form.valid"
    (click)="submit(); horseForm.form.markAsPristine()"
  >
    {{ this.formType === "add" ? "Add Horse" : "Update Horse" }}
  </button>

  <div
    *ngIf="horse"
    [hidden]="!(submitted && horseForm.form.pristine)"
    class="alert alert-success"
  >
    Horse {{ this.formType === "add" ? "added" : "saved" }}!
  </div>
</form>
